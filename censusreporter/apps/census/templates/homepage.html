{% extends '_base.html' %}{% load humanize %}

{% block head_title %}{{ block.super }}{% endblock %}

{% block head_extra_css %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/vendor/select2/select2.textinput.css">
{% endblock %}

{% block header %}
<header id="page-header"></header>
{% endblock %}

{% block content %}
<article id="homepage-search" class="clearfix">
    <section class="column-golden-wide">
        <img src="{{ STATIC_URL }}img/logo-large-block.png" class="logo">
        <div class="search-wrapper">
            <h1 class="title">CensusReporter</h1>
        </div>
    </section>
</article>

<article id="compare-and-analyze">
  <section class="column-half">
    <h2>Comparison and Analysis</h2>
    <p>
      Use our <a href="{% url 'comparison_builder' %}">comparison tool</a> to select the topic and places you are interested in. Census Reporter will deliver exactly the data you need. Look at it on the web in a table or on a map, or easily download for further analysis or to make your own maps.
    </p>
    <p><img src="{{ STATIC_URL }}img/tn-map-example.png" class="screenshot" alt="Relative concentration of 20-year-old males among counties in Tennessee"></p>
  </section>
</article>

<article id="find-a-profile">
  <section class="column-half">
    <h2>I'm looking for facts about a place</h2>
    <input name="geography_select" id="geography-select" type="text" placeholder="Start typing to find a place..." autocomplete="off">
    <p class="explain">
      This feature of Census Reporter is under active development, so may occasionally appear incomplete or even be broken. We'll be at the <a href="http://journalists.org/conference/ona13/">Online News Association conference, October 17-19</a> to introduce it. Come by "the midway" and tell us what you think! 
    </p>
  </section>
</article>
<article id="welcome" class="clearfix">
    <header>
        <h2>About this project</h2>
    </header>
    <section class="column-golden-wide">
        <a href="/compare/04000US53/050/distribution/"><img src="{{ STATIC_URL }}img/comparison_screenshot.png" class="screenshot"></a>
        <p class="caption">Detail of <strong>Age groups by percentage of total population, Counties in Washington State</strong>. <a href="/compare/04000US53/050/distribution/">View</a></p>
    </section>
    <section class="column-golden-narrow">
        <p>CensusReporter is a <a href="http://www.knightfoundation.org/press-room/press-release/six-ventures-bring-data-public-winners-knight-news/">Knight News Challenge-funded project</a> to make it easy for journalists to write stories using U.S. Census data. Expanding upon the volunteer-built <a href="http://census.ire.org">Census.ire.org</a>, Census Reporter will simplify finding and using data from the decennial census and the American Community Survey. The goal of the new site is to include much more data, to provide a friendlier interface for navigating all of that data, and, as much as possible, to use visualizations to provide a more useful first look at the data.</p>
        <p>In the spirit of open and iterative development, we&rsquo;re making this site available to the public as early as possible. Much will change, and some things may not be working at any moment, but we want people to see what we&rsquo;re working on and we welcome input about what might be most useful.</p>
    </section>
</article>

{% comment %}
<div id="twitter-widget">
  <a class="twitter-timeline" href="https://twitter.com/CensusReporter" data-widget-id="344899396074369024">Tweets by @CensusReporter</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </div>
{% endcomment %}
{% endblock %}

{% block body_javascript_extra %}
<script src="{{ STATIC_URL }}js/vendor/typeahead.js"></script>
<script src="{{ STATIC_URL }}js/vendor/hogan-2.0.0.js"></script>
<script src="{{ STATIC_URL }}js/vendor/spin.min.js"></script>
<script type="text/javascript">
var geoSearchAPI = 'http://api.censusreporter.org/1.0/geo/search',
    geoSelect = $('#geography-select');
    
function makeGeoSelectWidget(element) {
    element.typeahead({
        name: 'geographies',
        valueKey: 'full_name',
        remote: {
            url: geoSearchAPI,
            replace: function (url, uriEncodedQuery) {
                return url += '?q=' + uriEncodedQuery + '&sumlevs=010,020,030,040,050,160,250,310,500,610,620,860,950,960,970'
            },
            filter: function(response) {
                response.map(function(item) {
                    item['sumlev_name'] = sumlevMap[item['sumlevel']]
                });
                return response
            }
        },
        limit: 20,
        template: {% verbatim %}'<p class="result-name"><span class="result-type">{{sumlev_name}}</span>{{full_name}}</p>'{% endverbatim %},
        engine: Hogan
    });

    element.on('typeahead:selected', function(obj, datum) {
        window.location = '/profiles/' + datum['full_geoid'];
    });
}


jQuery(document).ready(function(){
    makeGeoSelectWidget(geoSelect);
})
</script>
{% endblock %}