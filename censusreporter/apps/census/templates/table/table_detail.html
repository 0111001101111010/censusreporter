{% extends 'table/_base_table.html' %}

{% block head_title %}Table {{ table.table_id }}: {{ table.simple_table_title }} - {{ block.super }}{% endblock %}

{% block head_facebook_tags %}
        <meta property="og:title" content="Census tabulation detail: {{ table.simple_table_title }}" />
        <meta property="og:site_name" content="Census Reporter" />
        <meta property="og:url" content="http://censusreporter.org{% url 'table_detail' table.table_id %}" />
        <meta property="og:description" content="Description and table metadata for Census tabulation {{ table.table_id }}: {{ table.table_title }}." />
        <meta property="og:type" content="article" />
        {#}<meta property="og:image" content="" />{#}
{% endblock %}

{% block head_twitter_tags %}
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@CensusReporter">
        <meta name="twitter:creator" content="@CensusReporter">
        <meta name="twitter:title" content="Census tabulation detail: {{ table.simple_table_title }}">
        <meta name="twitter:description" content="Description and table metadata for Census tabulation {{ table.table_id }}: {{ table.table_title }}.">
        {#}<meta name="twitter:image" content="">{#}
{% endblock %}

{% block body_id %}table{% endblock %}
{% block body_class %}data-view{% endblock %}

{% block header_content %}
<div id="header-container" class="wrapper clearfix header-container">
</div>
{% endblock %}

{% block content %}

<article id="one-year-release" class="clearfix">
    <header class="section-contents">
        <h1>Table {{ table.table_id }}</h1>
    </header>
    <div class="section-container">
        <section class="clearfix">
            <h2 class="header-for-columns">{{ table.simple_table_title }}</h2>
            <aside>
                {% if tabulation.table_versions|length > 1 %}
                <h5>Other versions of this table</h5>
                <ul>{% for code, option in tabulation.table_versions.items %}
                    {% if code != table.table_id %}<li><a href="{% url 'table_detail' code %}">{{ option.version_name }}</a></li>{% endif %}
                {% endfor %}</ul>
                {% endif %}
            </aside>
            <p class="caption"><strong>Table universe:</strong> {{ table.universe }}</p>

            <div class="column-golden-wide expanded-table">
                <ul>{% for column_id, column_data in table.columns.items %}
                    <li class="indent-{{ column_data.indent }}">{{ column_data.column_title }}</li>
                {% endfor %}</ul>
            </div>
            
            <div class="column-golden-narrow">
                {% if related_topic_pages %}
                <div class="sidebar-block">
                    <h4>Background on table topics</h4>
                    <p class="explain"><a href="{% url 'topic_list' %}">Topic pages</a> describe concepts covered by the ACS. For background on the topics in Table {{ table.table_id }}, see:</p>
                    <ul>{% for slug, title in related_topic_pages %}
                        <li><a href="{% url 'topic_detail' slug %}">{{ title }}</a></li>
                        {% endfor %}</ul>
                </div>
                {% endif %}

                {% for table, table_values in tabulation.related_tables.preview.items %}
                <div class="sidebar-block preview-table">
                    <h4>{{ table_values.table_type }} table</h4>
                    <p class="explain">The Census offers a version of this table with {% if table_values.table_type == 'Collapsed' %}a simplified{% else %}an expanded{% endif %} set of columns.</p>
                    
                    <h5><a href="{% url 'table_detail' table %}">Switch to Table {{ table }}</a></h5>
                    <ul>{% for column_id, column_data in table_values.columns.items %}
                        <li class="indent-{{ column_data.indent }}">{{ column_data.column_title }}</li>
                    {% endfor %}</ul>
                </div>{% endfor %}
            </div>
        </section>
    </div>
</article>
{% endblock %}

{% block body_javascript_extra %}{{ block.super }}
<script type="text/javascript">
var tableID = '{{ table.table_id }}';
Glossary.init("{% url 'glossary' %}",".glossary-term");

var previewTable = d3.select('.preview-table ul'),
    previewCollapsedHeight = '160px',
    previewExpandText = 'Show all preview columns &#x25BC;',
    previewFullHeight = previewTable.node().offsetHeight + 'px';

previewTable
    .style('overflow', 'hidden')
    .style('height', previewCollapsedHeight);
    
var previewTableToggleControl = d3.select('.preview-table')
    .append('a')
        .classed('expand-preview', true)
        .attr('href', '#')
        .html(previewExpandText)
        .on('click', function() {
            previewTableToggle();
        })

var previewTableToggle = function() {
    d3.event.preventDefault();
    if (previewTable.classed('open')) {
        previewTableAnimate(false, previewCollapsedHeight);
    } else {
        previewTableAnimate(true, previewFullHeight);
    }
}

var previewTableAnimate = function(toOpen, targetHeight) {
    previewTable
        .classed('open', toOpen)
        .transition()
        .duration(500)
        .style('height', targetHeight);
    
    var toggleText = (toOpen) ? 'Collapse preview columns &#x25B2;' : previewExpandText;
    previewTableToggleControl.html(toggleText);
}
</script>
{#}<script src="{{ STATIC_URL }}js/table.geo.picker.js"></script>{#}
{% endblock %}